IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
GO

BEGIN TRANSACTION;
CREATE TABLE [PACIENTE] (
    [ID] int NOT NULL IDENTITY,
    [NOME] nvarchar(150) NOT NULL,
    [DATA_NASCIMENTO] datetime2 NOT NULL,
    [ENDERECO] nvarchar(200) NULL,
    [GENERO] int NOT NULL,
    CONSTRAINT [PK_PACIENTE] PRIMARY KEY ([ID])
);

CREATE TABLE [PEDIDOEXAME] (
    [ID] int NOT NULL IDENTITY,
    [PACIENTEID] int NOT NULL,
    [ExameId] int NOT NULL,
    [DATAPEDIDO] datetime2 NOT NULL,
    [MEDICOSOLICITANTE] nvarchar(100) NOT NULL,
    [STATUSPEDIDOEXAME] int NOT NULL,
    [OBSERVACOES] nvarchar(255) NOT NULL,
    CONSTRAINT [PK_PEDIDOEXAME] PRIMARY KEY ([ID]),
    CONSTRAINT [FK_PEDIDOEXAME_PACIENTE_PACIENTEID] FOREIGN KEY ([PACIENTEID]) REFERENCES [PACIENTE] ([ID]) ON DELETE CASCADE
);

CREATE TABLE [EXAME] (
    [ID] int NOT NULL IDENTITY,
    [DESCRICAO] nvarchar(max) NOT NULL,
    [TIPOEXAME] nvarchar(max) NOT NULL,
    [DATAEXAME] datetime2 NOT NULL,
    [DATAENTREGARESULTADO] datetime2 NOT NULL,
    [STATUSEXAME] int NOT NULL,
    [OBSERVACOES] nvarchar(255) NOT NULL,
    [PedidoExameId] int NULL,
    CONSTRAINT [PK_EXAME] PRIMARY KEY ([ID]),
    CONSTRAINT [FK_EXAME_PEDIDOEXAME_PedidoExameId] FOREIGN KEY ([PedidoExameId]) REFERENCES [PEDIDOEXAME] ([ID])
);

CREATE TABLE [ITENSPEDIDOEXAME] (
    [ID] int NOT NULL IDENTITY,
    [PEDIDOEXAMEID] int NOT NULL,
    [EXAMEID] int NOT NULL,
    [OBSERVACOES] nvarchar(255) NOT NULL,
    CONSTRAINT [PK_ITENSPEDIDOEXAME] PRIMARY KEY ([ID]),
    CONSTRAINT [FK_ITENSPEDIDOEXAME_EXAME_EXAMEID] FOREIGN KEY ([EXAMEID]) REFERENCES [EXAME] ([ID]) ON DELETE CASCADE,
    CONSTRAINT [FK_ITENSPEDIDOEXAME_PEDIDOEXAME_PEDIDOEXAMEID] FOREIGN KEY ([PEDIDOEXAMEID]) REFERENCES [PEDIDOEXAME] ([ID]) ON DELETE CASCADE
);

CREATE INDEX [IX_EXAME_PedidoExameId] ON [EXAME] ([PedidoExameId]);

CREATE INDEX [IX_ITENSPEDIDOEXAME_EXAMEID] ON [ITENSPEDIDOEXAME] ([EXAMEID]);

CREATE INDEX [IX_ITENSPEDIDOEXAME_PEDIDOEXAMEID] ON [ITENSPEDIDOEXAME] ([PEDIDOEXAMEID]);

CREATE INDEX [IX_PEDIDOEXAME_PACIENTEID] ON [PEDIDOEXAME] ([PACIENTEID]);

INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20250420230450_Initial', N'9.0.4');

COMMIT;
GO

